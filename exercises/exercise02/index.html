<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Memory bandwidth in the memory hierarchy #  The goal of this exercise is to determine the memory bandwidth as a function of the amount of data we are moving on the Hamilton cores.
As done in the the first exercise we will use likwid-bench. This time we will use three different benchmarks:
  clcopy: Double-precision cache line copy, which only touches first element of each cache line.
  clload: Double-precision cache line load, which only loads first element of each cache line."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Memory bandwidth in the memory hierarchy"><meta property="og:description" content="Memory bandwidth in the memory hierarchy #  The goal of this exercise is to determine the memory bandwidth as a function of the amount of data we are moving on the Hamilton cores.
As done in the the first exercise we will use likwid-bench. This time we will use three different benchmarks:
  clcopy: Double-precision cache line copy, which only touches first element of each cache line.
  clload: Double-precision cache line load, which only loads first element of each cache line."><meta property="og:type" content="article"><meta property="og:url" content="https://scicomp-durham.github.io/COMP52315/exercises/exercise02/"><meta property="article:modified_time" content="2023-02-08T02:19:00+00:00"><title>Memory bandwidth in the memory hierarchy | COMP52315 – Performance Engineering, Vectorisation and GPU Programming</title><link rel=icon href=/COMP52315/favicon.svg type=image/x-icon><link rel=stylesheet href=/COMP52315/book.min.0cb0b7d6a1ed5d0e95321cc15edca4d6e9cc406149d1f4a3f25fd532f6a3bb38.css integrity="sha256-DLC31qHtXQ6VMhzBXtyk1unMQGFJ0fSj8l/VMvajuzg="></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><div class=book-brand><img class=book-center src=/COMP52315/logo.svg alt=Logo><h2><a href=/COMP52315>COMP52315 – Performance Engineering, Vectorisation and GPU Programming</a></h2></div><ul><li><span>Course resources</span><ul><li><a href=/COMP52315/setup/contact/>Contact details</a></li><li><a href=/COMP52315/setup/hamilton/>Hamilton accounts</a></li><li><a href=/COMP52315/setup/configuration/>ssh configuration</a></li><li><a href=/COMP52315/setup/unix/>Unix resources</a></li></ul></li><li><a href=/COMP52315/journal/>Journal</a></li><li><a href=/COMP52315/exercises/>Exercises</a><ul></ul></li><li><a href=/COMP52315/notes/>Notes</a><ul></ul></li><li><a href=/COMP52315/resources/>Further resources</a></li><li><a href=/COMP52315/acknowledgements/>Acknowledgements</a></li><li><a href=/COMP52315/past-editions/>Past editions</a><ul><li><a href=/COMP52315/past-editions/2020-21/>Edition 2020/2021</a><ul></ul></li><li><a href=/COMP52315/past-editions/2021-22/>Edition 2021/2022</a><ul></ul></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/COMP52315/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Memory bandwidth in the memory hierarchy</strong>
<label for=toc-control><img src=/COMP52315/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#memory-bandwidth-in-the-memory-hierarchy>Memory bandwidth in the memory hierarchy</a><ul><li><a href=#running-the-benchmarks>Running the benchmarks</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=memory-bandwidth-in-the-memory-hierarchy>Memory bandwidth in the memory hierarchy
<a class=anchor href=#memory-bandwidth-in-the-memory-hierarchy>#</a></h1><p>The goal of this exercise is to determine the memory bandwidth as a function of
the amount of data we are moving on the Hamilton cores.</p><p>As done in the <a href=https://scicomp-durham.github.io/COMP52315/exercises/exercise01/>the first exercise</a> we will use
<code>likwid-bench</code>. This time we will use three different benchmarks:</p><ol><li><p><a href=https://github.com/RRZE-HPC/likwid/blob/master/bench/x86-64/clcopy.ptt><code>clcopy</code></a>:
Double-precision cache line copy, which only touches first element of each cache line.</p></li><li><p><a href=https://github.com/RRZE-HPC/likwid/blob/master/bench/x86-64/clload.ptt><code>clload</code></a>:
Double-precision cache line load, which only loads first element of each cache
line.</p></li><li><p><a href=https://github.com/RRZE-HPC/likwid/blob/master/bench/x86-64/clstore.ptt><code>clstore</code></a>:
Double-precision cache line store, which only stores first element of each cache
line.</p></li></ol><p>These benchmarks do the minimal amount of work while moving data in cache lines
(64 bytes at a time), and therefore they exercise the memory bandwidth
bottlenecks (rather than instruction issue or similar).</p><h2 id=running-the-benchmarks>Running the benchmarks
<a class=anchor href=#running-the-benchmarks>#</a></h2><p>As mentioned, this time we want to measure memory bandwidth with the
<code>clcopy</code>, <code>clload</code>, and <code>clstore</code>
benchmarks. We are interested in the (highlighted) MByte/s output of
<code>likwid-bench</code>. For example running</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-sh data-lang=sh>likwid-bench -t clcopy -w N:1kB:1
</code></pre></div><p>produces the following output.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa><code class=language-txt data-lang=txt>Warning: Sanitizing vector length to a multiple of the loop stride 32 and thread count 1 from 62 elements (496 bytes) to 32 elements (256 bytes)
Allocate: Process running on hwthread 22 (Domain N) - Vector length 32/256 Offset 0 Alignment 512
Allocate: Process running on hwthread 22 (Domain N) - Vector length 32/256 Offset 0 Alignment 512
--------------------------------------------------------------------------------
LIKWID MICRO BENCHMARK
Test: clcopy
--------------------------------------------------------------------------------
Using 1 work groups
Using 1 threads
--------------------------------------------------------------------------------
Running without Marker API. Activate Marker API with -m on commandline.
--------------------------------------------------------------------------------
Group: 0 Thread 0 Global Thread 0 running on hwthread 22 - Vector length 32 Offset 0
--------------------------------------------------------------------------------
Cycles:                 4032322860
CPU Clock:              1996234632
Cycle Clock:            1996234632
Time:                   2.019964e+00 sec
Iterations:             536870912
Iterations per thread:  536870912
Inner loop executions:  1
Size (Byte):            512
Size per thread:        512
Number of Flops:        0
MFlops/s:               0.00
Data volume (Byte):     274877906944
<span style=display:block;width:100%;background-color:#e1e1e1>MByte/s:                136080.57
</span>Cycles per update:      0.234712
Cycles per cacheline:   1.877697
Loads per update:       1
Stores per update:      1
Load bytes per element: 8
Store bytes per elem.:  8
Load/store ratio:       1.00
Instructions:           5905580048
UOPs:                   7516192768
--------------------------------------------------------------------------------
</code></pre></div><blockquote class=exercise><h3>Exercise</h3><span><p>Produce a plot of memory bandwidth as a function of the size vector
being streamed from 1kB up to 1GB for each of the three different
benchmarks.</p><p>As before, you can script this data collection with a <a href=https://scicomp-durham.github.io/COMP52315/exercises/exercise01/#scripting-the-data-collection>bash loop</a>.</p></span></blockquote><blockquote class=question><h3>Question</h3><span>What do you observe about the available memory bandwidth?
Is the bandwidth the same for 1kB and 1GB vectors? Why?</span></blockquote><blockquote class=exercise><h3>Exercise</h3><span>Use <code>likwid-topology</code> to find out about the
different sizes of cache available on the system. You can find
out how to use it by providing the <code>-h</code>
command-line flag. The graphical output (<code>-g</code>) is most useful. However, a
compute node of Hamilton 8 has 64 cores per socket, which will most likely mess
up the view; the command <code>less -S</code> might come in handy.</span></blockquote><blockquote class=question><h3>Question</h3><span>Can you use the output from <code>likwid-topology</code> to explain and
understand your memory bandwidth results?</span></blockquote></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/scicomp-durham/COMP52315/commit/5e994206d6719c797436471e6da757e835e3610b title="Last modified by Massimiliano Fasi | February 8, 2023" target=_blank rel=noopener><img src=/COMP52315/svg/calendar.svg class=book-icon alt=Calendar>
<span>February 8, 2023</span></a></div><div><a class="flex align-center" href=https://github.com/scicomp-durham/COMP52315/edit/main/site/content//exercises/exercise02.md target=_blank rel=noopener><img src=/COMP52315/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><div class="flex flex-wrap align-right"><p>© 2020&ndash;2023 <a href=mailto:lawrence@wence.uk>Lawrence Mitchell</a>, <a href=mailto:massimiliano.fasi@durham.ac.uk>Massimiliano Fasi</a>, and <a href=https://www.dur.ac.uk/>Durham University</a>.</p><p><a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/><img alt="Creative Commons License" style=border-width:0 src=/COMP52315/cc-by-sa.svg></a>
This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>Creative
Commons Attribution-ShareAlike 4.0 International License</a>.</p></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#memory-bandwidth-in-the-memory-hierarchy>Memory bandwidth in the memory hierarchy</a><ul><li><a href=#running-the-benchmarks>Running the benchmarks</a></li></ul></li></ul></nav></aside></main></body></html>